<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Calory Web App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
    <link rel="icon" href="images/favicon.png" type="image/png">
    <style>
        /* Tayyor stillar */
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap');
        body { font-family: 'Poppins', sans-serif; }
        .hidden { display: none !important; }
        .shadow-modern { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1); }
        .tab-button.active { border-color: #10B981; color: #10B981 !important; }
        .tab-content { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Dark Theme Stillari - TO'LIQ QORA VA STIL OQMASIN */
        .dark {
            background-color: #000000 !important; 
            color: #f0f0f0; 
        }
        .dark .bg-white { background-color: #121212 !important; }
        .dark .bg-gray-50, .dark .bg-gray-100 { background-color: #000000 !important; }
        .dark input, .dark textarea { background-color: #1f1f1f !important; border-color: #333 !important; color: #f0f0f0 !important; }
        .dark .text-gray-800 { color: #f0f0f0; }
        .dark .text-gray-600 { color: #ccc; }
        .dark .tab-button:not(.active) { color: #ccc !important; }
        
        /* Bar chart stillari */
        .bar-container { display: flex; align-items: flex-end; height: 150px; border-left: 1px solid #ddd; border-bottom: 1px solid #ddd; padding-left: 5px; }
        .bar-item { width: 30px; margin-right: 2px; background-color: #34D399; position: relative; transition: height 0.5s ease; }
        /* Yangi Bar Chart Stillari */
        .bar-item { transition: height 0.5s ease; position: relative; }
        .bar-tooltip { 
            position: absolute; 
            top: -35px; 
            left: 50%; 
            transform: translateX(-50%); 
            background-color: rgba(0, 0, 0, 0.8); 
            color: white; 
            padding: 5px 8px; 
            border-radius: 5px; 
            font-size: 12px; 
            white-space: nowrap; 
            opacity: 0; 
            pointer-events: none; 
            transition: opacity 0.3s; 
            z-index: 10;
        }
        .bar-item:hover .bar-tooltip { opacity: 1; }
        
    </style>
</head>
<body class="bg-gray-50 dark:bg-[#000000] transition-colors duration-500" id="mainApp">
    
    <canvas id="floatingBallsCanvas" class="absolute inset-0 w-full h-full z-0"></canvas>

    <div class="relative z-10 container mx-auto p-4 md:p-8 min-h-screen">
        <header class="flex justify-between items-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-100 flex items-center gap-2">
                <i class="fas fa-bolt text-yellow-500"></i> Calory Web App
            </h1>
            <div class="flex items-center gap-3">
                <button id="themeToggle" class="p-2 rounded-full text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-[#1f1f1f] transition-colors">
                    <i class="fas fa-moon" id="themeIcon"></i>
                </button>
                <button id="profileBtn" class="p-2 rounded-full text-white bg-green-500 hover:bg-green-600 transition-colors">
                    <i class="fas fa-user-circle text-2xl"></i>
                </button>
                <button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white text-sm px-4 py-2 rounded-lg transition-colors duration-300 hidden md:inline-block">
                    <i class="fas fa-sign-out-alt"></i> Chiqish
                </button>
            </div>
        </header>

        <div class="bg-white dark:bg-[#121212] rounded-2xl shadow-modern p-6 mb-8 transition-colors duration-300">
             <div class="flex flex-col md:flex-row gap-4 items-stretch">
                <input type="text" id="foodInput" placeholder="Taom nomini yozing (masalan, 100g osh)" class="flex-grow p-3 border border-gray-300 dark:border-gray-700 rounded-lg dark:bg-[#1f1f1f] dark:text-gray-200 focus:ring-green-500 focus:border-green-500">
                
                <label for="imageUpload" id="imageUploadLabel" class="flex-shrink-0 flex items-center justify-center w-full md:w-32 border-2 border-dashed border-gray-400 dark:border-gray-600 rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-[#1a1a1a] transition-colors duration-300 min-h-[50px]">
                    <div class="text-center p-2">
                        <i class="fas fa-plus-circle text-xl text-green-500 mb-1"></i>
                        <p id="imageUploadText" class="text-xs font-semibold text-gray-600 dark:text-gray-300">Rasm yuklang</p>
                        <p id="imageFileName" class="text-xs text-gray-500 dark:text-gray-400 truncate max-w-[100px] hidden"></p>
                    </div>
                    <input type="file" id="imageUpload" accept="image/*" class="hidden"/>
                </label>
                
                <button id="searchBtn" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 px-6 rounded-lg transition-colors duration-300 flex items-center justify-center min-w-[120px]">
                    <i class="fas fa-search mr-2"></i> Hisoblash
                </button>
            </div>
        </div>

        <div class="bg-white dark:bg-[#121212] rounded-2xl shadow-modern p-6 transition-colors duration-300">
            <div class="flex border-b border-gray-200 dark:border-gray-700">
                <button id="tabResult" data-tab="result" class="tab-button active px-4 py-2 text-sm font-medium text-green-500 transition-colors">Natija</button>
                <button id="tabHistory" data-tab="history" class="tab-button px-4 py-2 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors">Tarix</button>
                <button id="tabStats" data-tab="stats" class="tab-button px-4 py-2 text-sm font-medium text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors">Statistika</button> 
            </div>

            <div class="tab-content p-4" id="tabContent-result">
                <div id="result" class="space-y-4">
                    </div>
                <div id="emptyResult" class="text-center text-gray-500 dark:text-gray-400 py-10">
                    <i class="fas fa-utensils text-4xl mb-3 text-green-500"></i>
                    <p class="font-semibold">Kaloriya hisobini boshlash uchun yuqoriga taom nomini kiriting.</p>
                </div>
            </div>

            <div class="tab-content hidden p-4" id="tabContent-history">
                <div id="historyList" class="space-y-3">
                    </div>
                <div class="text-center mt-6">
                    <button id="clearHistoryBtn" class="text-sm text-red-500 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 font-medium transition-colors">
                        <i class="fas fa-trash-alt mr-1"></i> Tarixni Tozalash
                    </button>
                </div>
                <p id="emptyHistory" class="text-center text-gray-500 dark:text-gray-400 py-10 hidden">Hali hech qanday kirim yoʻq.</p>
            </div>
            
            <div class="tab-content hidden p-4" id="tabContent-stats">
                <div id="statsContent">
                    <h3 class="text-xl font-bold mb-4 text-gray-800 dark:text-gray-100 flex items-center gap-2">
                        <i class="fas fa-chart-bar text-blue-500"></i> Kunlik Kaloriya Grafikasi (7 kun)
                    </h3>
                    
                    <div id="statsBarContainer" class="flex h-64 border-l border-b border-gray-300 dark:border-gray-700 pt-2 relative items-end">
                        </div>
                    <p class="text-center text-sm text-gray-500 dark:text-gray-400 mt-2">Kunlar</p>
                    
                    <h3 class="text-xl font-bold mt-8 mb-4 text-gray-800 dark:text-gray-100 flex items-center gap-2">
                        <i class="fas fa-seedling text-green-500"></i> Oʻrtacha Kunlik Makroslar (30 kun)
                    </h3>
                    
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div class="p-4 bg-gray-100 dark:bg-[#1f1f1f] rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
                            <p class="text-lg font-bold text-blue-500" id="avgProtein">0g</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Protein</p>
                        </div>
                        <div class="p-4 bg-gray-100 dark:bg-[#1f1f1f] rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
                            <p class="text-lg font-bold text-yellow-500" id="avgFat">0g</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Yogʻ</p>
                        </div>
                        <div class="p-4 bg-gray-100 dark:bg-[#1f1f1f] rounded-xl shadow-sm border border-gray-200 dark:border-gray-700">
                            <p class="text-lg font-bold text-green-500" id="avgCarbs">0g</p>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Uglevod</p>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
        </div> 
    
    <div id="profileModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white dark:bg-[#121212] rounded-xl shadow-2xl p-6 w-full max-w-md transition-all duration-300">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-100 flex items-center gap-2">
                    <i class="fas fa-user-circle text-green-500"></i> Profil
                </h3>
                <button id="closeProfileModal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <p class="text-lg text-gray-600 dark:text-gray-300 mb-4">
                Foydalanuvchi: <span id="profileUsername" class="font-bold text-green-500"></span>
            </p>
            
            <form id="changePasswordForm" class="space-y-4">
                <h4 class="font-semibold text-gray-700 dark:text-gray-200 mt-6 border-t pt-4">Parolni almashtirish</h4>
                <input type="password" id="currentPassword" placeholder="Joriy parol" class="w-full p-3 border border-gray-300 dark:border-gray-700 rounded-lg dark:bg-[#1f1f1f] dark:text-gray-200 focus:ring-green-500 focus:border-green-500" required>
                <input type="password" id="newPassword" placeholder="Yangi parol (min 6 belgi)" class="w-full p-3 border border-gray-300 dark:border-gray-700 rounded-lg dark:bg-[#1f1f1f] dark:text-gray-200 focus:ring-green-500 focus:border-green-500" required>
                <button type="submit" class="w-full bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 rounded-lg transition-colors duration-300">Parolni Yangilash</button>
                <div id="profileError" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4 dark:bg-red-900/30 dark:border-red-600 dark:text-red-300">
                    <p id="profileErrorMessage"></p>
                </div>
                <div id="profileSuccess" class="hidden bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded relative mb-4 dark:bg-green-900/30 dark:border-green-600 dark:text-green-300">
                    <p id="profileSuccessMessage"></p>
                </div>
            </form>

            <button id="logoutBtnModal" class="w-full bg-red-500 hover:bg-red-600 text-white font-semibold py-3 rounded-lg mt-6 transition-colors duration-300">
                <i class="fas fa-sign-out-alt"></i> Chiqish
            </button>
        </div>
    </div>
    
    <div id="detailModal" class="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 hidden p-4">
        <div class="bg-white dark:bg-[#121212] rounded-xl shadow-2xl p-6 w-full max-w-md transition-all duration-300">
            <div class="flex justify-between items-center mb-4">
                <h3 id="detailFoodName" class="text-2xl font-bold text-gray-800 dark:text-gray-100">...</h3>
                <button id="closeDetailModal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
            <div id="detailContent">
                </div>
        </div>
    </div>


    <div id="loading" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40 hidden">
        <div class="bg-white dark:bg-[#121212] p-6 rounded-xl shadow-2xl text-center">
            <i class="fas fa-spinner fa-spin text-green-500 text-4xl mb-3"></i>
            <p id="loadingMessage" class="text-gray-700 dark:text-gray-200 font-semibold">Hisoblanmoqda...</p>
        </div>
    </div>
    
    <div id="errorDiv" class="fixed bottom-4 right-4 bg-red-100 border-l-4 border-red-500 text-red-700 p-4 shadow-lg rounded-lg max-w-sm z-50 hidden dark:bg-red-900/50 dark:border-red-400 dark:text-red-300" role="alert">
        <p class="font-bold">Xatolik:</p>
        <p id="errorMessage" class="text-sm"></p>
    </div>

    <script src="script.js"></script>

</body>
</html>